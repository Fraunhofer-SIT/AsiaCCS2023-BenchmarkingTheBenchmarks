package de.fraunhofer.sit.runexploits.servletcontainers;

import java.net.InetSocketAddress;
import java.net.URL;
import java.net.URLClassLoader;
import java.util.EventListener;
import java.util.Map.Entry;

import javax.servlet.ServletRegistration;

import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.ServerConnector;
import org.eclipse.jetty.webapp.WebAppContext;

public class JettyContainer extends ServletContainerReference {

	private static final int PORT = 8082;

	@Override
	public int getPort() {
		return PORT;
	}

	@Override
	public String getName() {
		return "Jetty";
	}

	@Override
	public void startServletContainer(String webAppPath) throws Throwable {
		System.out.println("starting jetty...");
		
		ClassLoader cl = ClassLoader.getSystemClassLoader();

        
		Server server = new Server(new InetSocketAddress("0.0.0.0", PORT));
		WebAppContext webapp = new WebAppContext();
		for (EventListener e : listeners) {
			webapp.addEventListener(e);
		}
		webapp.setContextPath("/");
		webapp.setResourceBase(webAppPath);
	    webapp.setClassLoader(cl);
		server.setHandler(webapp);
		server.start();
		server.join();
	}

	@Override
	public String getVersion() {
		return "10.0.2";
	}

	@Override
	public boolean usesJakarta() {
		return false;
	}
	
	public static void main(String[] args) throws Throwable {
		new JettyContainer().start(args[0]);
	}

}
