package de.fraunhofer.sit.runexploits.servletcontainers;

import java.util.EventListener;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletContextListener;

import winstone.Launcher;

public class WinstoneContainer extends ServletContainerReference {

	private static final int PORT = 8080;

	@Override
	public int getPort() {
		return PORT;
	}

	@Override
	public String getName() {
		return "Winstone";
	}

	@Override
	public void startServletContainer(String webAppPath) throws Throwable {

		Map args = new HashMap();
		args.put("webroot", webAppPath);
		args.put("httpPort", String.valueOf(PORT));
		Launcher.initLogger(args);
		Launcher l = new Launcher(args);
		Thread.sleep(1000);
		for (EventListener e : listeners) {
			if (e instanceof ServletContextListener) {
				ServletContextListener listener = (ServletContextListener) e;
				try {
					listener.contextInitialized(null);
				} catch (Throwable ee) {
					ee.printStackTrace();
				}
			}
		}
	}

	@Override
	public String getVersion() {
		return "0.9.10";
	}

	@Override
	public boolean usesJakarta() {
		return false;
	}

	public static void main(String[] args) throws Throwable {
		new WinstoneContainer().start(args[0]);
	}

}
