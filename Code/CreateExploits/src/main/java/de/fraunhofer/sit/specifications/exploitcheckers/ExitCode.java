package de.fraunhofer.sit.specifications.exploitcheckers;

import java.io.File;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.w3c.dom.Node;

import de.fraunhofer.sit.specifications.codegen.CodeGenerator;
import de.fraunhofer.sit.specifications.codegen.IGenerateCode;
import de.fraunhofer.sit.specifications.testcases.TestCase;
import de.fraunhofer.sit.specifications.util.IXMLReadable;
import de.fraunhofer.sit.specifications.util.XMLUtils;

public class ExitCode extends SuccessfulExploitIndicator {
	public String processid;
	public int code;
	class Template {
		 static Process process;
		 
		public static boolean checkOutput(int code) throws InterruptedException {
			while (process.isAlive()) {
				System.out.println("[EXITCODE] waiting for process to finish...");
				Thread.sleep(1000);
			}
			int result = process.exitValue();
			System.out.println("[EXITCODE] exit code " + result);
			return result == code;
		}
		
	}
	@Override
	public String getTagName() {
		return "ExitCode";
	}

	@Override
	public void readIn(Node node) {
		processid = XMLUtils.getAttributeValue(node, "processid", "process0");
		code = Integer.valueOf(XMLUtils.getAttributeValue(node, "code"));
		
	}

	@Override
	public void generateCode(TestCase testcase, CodeGenerator generator) {
		generator.merge(Template.class, getFieldRenames());
	}

	@Override
	public List<Object> getParameterValues() {
		List<Object> params = new ArrayList<>();
		params.add(code);
		return params;
	}
	@Override
	public Map<String, String> getFieldRenames() {
		Map<String, String> names = new HashMap<>();
		names.put("process", processid);
		return names;
	}
}
